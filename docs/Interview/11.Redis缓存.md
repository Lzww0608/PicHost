# 11.Redis缓存

**1. user_info 表的部分信息 (Token 缓存):**

- **缓存内容:** **用户登录成功后生成的 Token 令牌**。 实际缓存的 Value 可能会包含与 Token 关联的 **用户名 (user_name)** 或其他用户身份信息，但文档中主要强调 Token 本身。
- **Redis 数据结构:** **String (字符串)**。 Token 值本身作为 Redis 的 Key，Value 可以是与 Token 关联的用户信息。
- **作用:**
  - **用户身份验证加速:** 每次 API 请求需要验证用户身份时，系统 **首先查询 Redis 缓存** 检查 Token 是否存在且有效，而 **无需每次都查询 MySQL 数据库**。 这极大地 **提高了身份验证速度**，并 **减轻了 MySQL 数据库的压力**。
  - **会话管理:** Redis 缓存的 Token 充当 **用户会话 (session)** 的凭证。 Token 的存在表示用户已登录，有效期由 Redis 的过期时间 (TTL) 控制。

**2. share_file_list 表的部分信息 (共享文件计数缓存):**

- **缓存内容:** **共享文件的总数量 (Total Count)**。
- **Redis 数据结构:** **String (字符串)** 或 **Integer (整数值)**。 Key 为 FILE_PUBLIC_COUNT (常量字符串)，Value 是共享文件总数量的 **数值字符串** 或 **整数值**。
- **作用:**
  - **加速获取共享文件总数:** 当客户端请求获取共享文件总数时 (例如，用于分页显示)，系统 **直接从 Redis 缓存读取计数**，而 **无需每次都查询 MySQL 数据库** 执行 count(*) 操作。 这 **显著提高了获取计数的速度**，尤其是在共享文件数量庞大时。
  - **减轻数据库压力:** 频繁的 count(*) 查询会增加数据库的负载，缓存计数可以 **有效降低数据库的查询压力**。

**3. user_file_list 表的部分信息 (用户文件计数缓存):**

- **缓存内容:** **每个用户的个人文件数量 (Count per User)**。
- **Redis 数据结构:** **String (字符串)** 或 **Integer (整数值)**。 Key 为 FILE_USER_COUNT + user_name (例如 FILE_USER_COUNTqingfu)，Value 是该用户的个人文件总数量的 **数值字符串** 或 **整数值**。
- **作用:**
  - **加速获取个人文件数量:** 当客户端请求获取用户的个人文件数量时，系统 **首先查询 Redis 缓存** 获取计数，而 **无需每次都查询 MySQL 数据库** 执行 count(*) 操作。 **提高了获取个人文件数量的速度**。
  - **用户文件数量快速展示:** 在用户登录后，可以快速加载并展示用户的个人文件数量， **提升用户体验**。

**4. share_file_list 表的部分信息 (共享文件排行榜缓存):**

- **缓存内容:** **共享文件的下载排行榜数据**。 包括 **文件标识 (Member)** 和 **下载量 (Score)**。
- **Redis 数据结构:** **ZSET (Sorted Set，有序集合)**。 Key 为 FILE_PUBLIC_ZSET (常量字符串)。
  - **Member:** 文件的唯一标识符，通常是 md5 + filename 拼接而成。
  - **Score:** 文件的下载量 (pv)，用于排行榜排序。
- **作用:**
  - **高效排行榜展示:** 客户端请求下载排行榜时，系统 **直接从 Redis ZSET 中读取排序好的数据**，并按下载量降序返回， **无需每次都查询 MySQL 数据库并进行排序**。 **极大地提高了排行榜的查询效率**。
  - **实时排行榜更新:** 文件的下载量 (pv) **实时更新到 Redis ZSET 中**，排行榜可以 **近乎实时地反映文件下载热度**。

**5. share_picture_list 表的部分信息 (共享图片信息缓存):**

- **缓存内容:** **共享图片的详细信息**，用于浏览分享图片链接时快速展示图片。 包括:
  - 图片下载 URL (file_url)
  - 分享者用户名 (user)
  - 图片文件名 (file_name)
  - 浏览次数 (pv)
  - 文件大小 (size)
  - 分享时间 (create_time)
- **Redis 数据结构:** **Hash (哈希)**。 Key 为 urlmd5 (分享链接的唯一标识符)。 Value 是一个 Hash 结构，包含上述图片信息的多个字段。
- **作用:**
  - **加速共享图片浏览:** 当用户访问分享链接时，系统 **首先查询 Redis 缓存** 获取图片详细信息， **避免了每次浏览都查询 MySQL 数据库**。 **显著提升了共享图片浏览速度**。
  - **提升用户体验:** 快速加载共享图片，提供更流畅的用户体验。

**总结:**

Redis 缓存主要用于 **缓存热点数据** 和 **高频访问的数据**， 以 **提高读取性能，降低数据库压力**。 缓存的数据包括：

- **身份验证信息 (Token)**
- **计数信息 (文件总数、用户文件数、共享图片数)**
- **排行榜数据 (共享文件下载排行榜)**
- **共享图片详细信息**